---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: deepfake-ui-v2
  namespace: deepfake
  labels:
    app: deepfake-ui-v2
spec:
  replicas: 1
  selector:
    matchLabels:
      app: deepfake-ui-v2
  template:
    metadata:
      labels:
        app: deepfake-ui-v2
    spec:
      containers:
        - name: ui
          image: ghcr.io/sunny-debug/cs598-ui:realeyes-20251020-1425
          imagePullPolicy: IfNotPresent
          workingDir: /app
          command:
            - python
            - -m
            - streamlit
          args:
            - run
            - streamlit_app/app.py
            - --server.port
            - "8501"
            - --server.address
            - 0.0.0.0
            - --server.headless
            - "true"
          env:
            - name: API_BASE
              value: http://deepfake-api-svc.deepfake.svc.cluster.local
            - name: API_URL
              value: http://deepfake-api-svc
            - name: STREAMLIT_RUNTIME_SCRATCH_DIR
              value: /tmp
          ports:
            - containerPort: 8501
          readinessProbe:
            httpGet:
              path: /
              port: 8501
            initialDelaySeconds: 5
            periodSeconds: 5
            timeoutSeconds: 2
            failureThreshold: 3
          livenessProbe:
            httpGet:
              path: /
              port: 8501
            initialDelaySeconds: 10
            periodSeconds: 10
            timeoutSeconds: 2
            failureThreshold: 3
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 500m
              memory: 512Mi
          securityContext:
            runAsNonRoot: true
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            seccompProfile:
              type: RuntimeDefault
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}